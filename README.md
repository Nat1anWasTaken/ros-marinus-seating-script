# ros-marinus-seating-script

因為懶得手動調整座位，寫了一個腳本來自動調整座位。

## 功能

本腳本會自動處理音樂會或類似活動的座位分配。它會：

1. 從 `available-seats.json` 讀取可用的座位區塊和座位。
2. 從 `preserved-seats.csv` (若存在) 讀取先前已分配的座位。這些座位將被視為已被佔用，並且如果觀眾的請求與這些保留座位中的記錄（根據取票人姓名和劃位時間）相符，則該請求將被視為已完成。
3. 從 `audiences.csv` 讀取觀眾的劃位請求，並依照時間戳記排序。
4. 根據請求時間的先後順序，為觀眾分配座位，跳過已在 `preserved-seats.csv` 中分配的座位，並將符合條件的請求標記為已完成。
5. 在終端機印出劃位結果。
6. 將劃位結果（包括未成功劃位的請求以及從 `preserved-seats.csv` 載入的座位）匯出成一個新的 CSV 檔案。

## 依賴套件

本腳本不再需要 `commentjson` 套件。

## 輸入檔案

腳本需要以下兩個檔案才能運作，且必須放在與 `main.py` 相同的目錄下：

### 1. `available-seats.json`

此檔案定義了可用的座位區塊及各區塊中的座位。它是一個 JSON 檔案。

**格式範例：**

```json
{
  "block-1": ["A1", "A2", "A3", "A4", "A5", "B1", "B2", "B3", "B4", "B5"],
  "block-2": ["C1", "C2", "C3", "D1", "D2", "D3"]
  // 可以有更多區塊...
}
```

- 區塊名稱（例如 `"block-1"`）應包含一個數字，腳本會依照此數字順序處理區塊。
- 每個區塊的值是一個包含座位號碼字串的列表。

### 2. `audiences.csv`

此檔案包含了觀眾的劃位請求。它是一個 CSV 檔案，第一列是標頭。
腳本現在使用 `csv.DictReader` 讀取此檔案，這表示欄位順序不再重要，但**欄位名稱必須完全符合預期**。

**必要欄位名稱與說明：**

- **時間戳記**: 請求提交的時間，格式為 `YYYY/MM/DD AM/PM HH:MM:SS` (例如 `2025/5/14 下午 5:51:07`)。這是排序請求的主要依據。
- **您的身分是**: 此欄位目前未使用，但應存在於 CSV 檔案中。
- **團員姓名**: 索票團員的姓名。
- **取票人姓名**: 實際持票人的姓名。如果此欄位為空，則會使用「團員姓名」。
- **票券張數**: 需要的票券數量。如果為空或 0，該請求將被忽略。
- **索票方式**: 領票方式的說明。
- **備註\\n 如行動不便等**: 備註欄位，目前未使用，但應存在於 CSV 檔案中。 (注意：CSV 檔案中的換行符號 `\\n` 應為實際換行，或腳本能正確處理包含換行的欄位名稱)

**CSV 範例：**

```csv
時間戳記,您的身分是,團員姓名,取票人姓名,票券張數,索票方式,"備註\\n如行動不便等"
2025/5/14 下午 5:51:07,團員,王小明,王大明,2,現場領票,
2025/5/14 上午 10:22:15,親友,陳小華,,1,親友代領,行動不便
```

- 腳本會使用 `utf-8-sig` 編碼讀取此檔案，以處理潛在的 BOM (Byte Order Mark)。
- 如果某列缺少必要的欄位名稱，或「票券張數」無法轉換為數字，該列將被跳過並顯示警告。

### 3. `preserved-seats.csv` (可選)

此檔案為可選檔案。如果存在，它包含了先前執行的劃位結果中已經分配的座位。腳本會讀取此檔案以：

- 確保這些座位不會被重新分配給新的請求。
- 如果 `audiences.csv` 中的某個請求（根據取票人姓名和劃位時間戳記）與 `preserved-seats.csv` 中的記錄完全相符，則該請求將被視為已處理，不會再嘗試為其分配新座位。
- 這些先前分配的座位也會被包含在最終的輸出 CSV 檔案中。

**格式：**

此檔案的格式應與腳本輸出的 CSV 檔案相同。必要欄位包括：

- **Block**: 座位區域名稱 (例如 `Block 1`)。
- **Seat Number**: 座位號碼 (例如 `A1`)。
- **Member Name**: 團員姓名。
- **Ticket Holder Name**: 取票人姓名。
- **Number of Tickets**: 通常為 `1`，代表一個座位。
- **Pickup Method**: 取票方式。
- **Allocation Time**: 當時分配的時間戳記，格式為 `YYYY/MM/DD HH:MM:SS` (例如 `2025/05/19 17:51:07`)。此時間戳記用於與 `audiences.csv` 中的請求進行匹配。

**CSV 範例：**

```csv
Block,Seat Number,Member Name,Ticket Holder Name,Number of Tickets,Pickup Method,Allocation Time
Block 1,A1,王小明,王大明,1,現場領票,2025/05/18 10:00:00
Block 2,C5,李小華,李大華,1,親友代領,2025/05/18 10:05:00
```

- 腳本會使用 `utf-8-sig` 編碼讀取此檔案。
- 如果檔案不存在，腳本會正常執行，只是不會有預先保留的座位。

## 使用方法

```bash
python main.py
```

執行後，腳本會：

1.  提示 `available-seats.json` 的讀取情況。
2.  提示 `preserved-seats.csv` 的讀取情況（如果檔案存在）。
3.  提示 `audiences.csv` 的讀取情況。
4.  顯示座位分配的過程，包括處理保留座位和新請求。
5.  在終端機印出詳細的劃位結果，包括每個區塊的劃位情況以及無法劃位的請求。
6.  最後，會提示您輸入一個檔名，以將結果匯出成 CSV 檔案。若未輸入檔名，則會跳過匯出步驟。如果輸入的檔名不以 `.csv` 結尾，腳本會自動添加。

## 輸出

### 1. 終端機輸出

腳本會在終端機中詳細列出每個區塊的座位分配情況：

```
--- Seating Assignment Results ---

Block 1 ======
A1: Member: 王小明, Ticket Holder: 王大明, Pickup: 現場領票, Time: 2025/05/14 17:51:07
A2: Member: 王小明, Ticket Holder: 王大明, Pickup: 現場領票, Time: 2025/05/14 17:51:07
...

--- Requests That Could Not Be Seated ---
- Ticket Holder: 陳小華, Tickets: 1, Time: 2025/05/14 10:22:15 (Original CSV Row: 3)
```

## 2. CSV 檔案匯出

腳本會將劃位結果（包括成功劃位和未成功劃位的請求）儲存到您指定的 CSV 檔案中。
匯出的 CSV 檔案包含以下欄位：

- Block
- Seat Number
- Member Name
- Ticket Holder Name
- Number of Tickets
- Pickup Method
- Allocation Time

**注意：** 由於 `audiences.csv` 的欄位名稱包含換行符（如 `備註\\n如行動不便等`），請確保 CSV 檔案本身正確處理此類欄位名稱，或者在 `main.py` 中讀取時有相應的處理邏輯。目前的修改假設 `csv.DictReader` 可以正確處理這些欄位名稱。

## 欄位對應 (audiences.csv)

腳本會從 `audiences.csv` 讀取以下欄位：

- `時間戳記` -> 用於排序及記錄
- `團員姓名` -> 記錄索票的團員
- `取票人姓名` -> 記錄實際的持票人 (若為空，則使用 `團員姓名`)
- `票券張數` -> 需要的票券數量
- `索票方式` -> 記錄領票方式

其他欄位如 `您的身分是` 和 `備註\\n如行動不便等` 雖然存在於 CSV 檔案中，但目前腳本並未使用其值。
